webpackJsonp([10],{Bn7K:function(t,a){},"gY/8":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("mvHQ"),s=e.n(i),n=(e("OgVB"),e("/Lyv")),o=e.n(n),r=(e("34+y"),e("X+yh")),l=e.n(r),d=e("//Fk"),c=e.n(d),m=e("mw3O"),v=e.n(m),h=e("FWuv"),u=e.n(h),_=e("E84t"),p=e.n(_),f=e("za2D"),g=e("hYS1"),b=e("Eg0l"),w={components:{"my-tab-container":f.a,upload:g.a,share:b.a},data:function(){return{tag_id:0,tag_name:"",tagData:{},loading:!1,check:!1,fixed:!1,showTitle:!1,loadVisible:!1,loadBotVisible:!1,swipeable:!0,kind:"",menuVisible:!1,active:"tab-container1",activeIndex:1,align:"left",maxHeight:"",maxWidth:"",navHeight:0,scrollHeight:0,maxDistance:0,tabstate:[0,0,0],data:{tab1:{page:1,records:0,total:0,more:!0,items:[]},tab2:{page:1,records:0,total:0,more:!0,items:[]}},browse_button:["browse","uploadBtn"],container:"tag",files:[],form:{moments_id:0,moments_title:"",moments_content:"",moments_tag_id:[],moments_area_id:0,moments_product_id:[],moments_tag_name:[],moments_area_name:"",moments_draft:1},shareData:{}}},methods:{tabIndex:function(t){var a;return"tab-container1"===t&&(a=0),"tab-container2"===t&&(a=1),a},tabId:function(){return"tab"+(this.activeIndex+1)},renderTab:function(t){this.active=t,this.activeIndex=this.tabIndex(t),this.tabstate[this.activeIndex]||(this.loadVisible=!0,this.getKind(),this.loadTab()),this.tabstate[this.activeIndex]=1},getKind:function(){var t="";0===this.activeIndex&&(t="latest"),1===this.activeIndex&&(t="hot"),this.kind=t},loadTab:function(){var t=this;this.loadMoments(this.kind).then(function(){return t.masonry()}).then(function(){t.loadBotVisible=!1,t.loadVisible=!1,t.loading=!1})},loadTop:function(){var t=this,a=this.tabId(),e={kind:this.kind,last_time:this.data[a].items[0].moments_time,tag_id:this.tag_id};new c.a(function(i,s){t.$http.get(SYS.URL.moments.lists,{params:e}).then(function(e){var s=e.data;if(200===s.status)if(s.data.total>0){t.dealData(s.data);var n=t.fixItems(s.data.items);t.data[a].items=n.concat(t.data[a].items)}else l()({message:"没有最新的动态了哦~",position:"top",duration:2e3});i(e)})}).then(function(){return t.loadBotVisible=!1,t.loadVisible=!1,t.loading=!1,t.$refs["loadmore"+(t.activeIndex+1)].onTopLoaded(),t.masonry()})},loadTagData:function(){var t=this;return new c.a(function(a,e){t.$http.get(SYS.URL.moments.tag_detail+"&tag_id="+t.tag_id).then(function(e){var i=e.data;200===i.status&&(t.tagData=i.data,t.form.moments_tag_id.push(i.data.tag_id),t.form.moments_tag_name.push(i.data.tag_name),t.shareData={title:i.data.tag_name,desc:i.data.tag_content,link:window.location.href,type:"link",imgUrl:i.data.tag_album,dataUrl:window.location.href}),a(e)})})},loadMore:function(){this.loading=!0,this.loadBotVisible=!0,this.loadTab()},loadMoments:function(t){var a=this,e=this.tabId(),i={kind:t,page:this.data[e].page,tag_id:this.tag_id};return new c.a(function(t,s){a.data[e].more?a.$http.get(SYS.URL.moments.lists,{params:i}).then(function(e){var i=e.data;if(200===i.status){var s=a.tabId();a.dealData(i.data);var n=a.fixItems(i.data.items);a.data[s].items.push.apply(a.data[s].items,n)}t(e)}):t(!0)})},doLike:function(t,a){var e=this,i=v.a.stringify({moments_id:t});this.$http.post(SYS.URL.moments.like_add,i).then(function(t){var i=t.data;if(200===i.status){var s=e.tabId();e.data[s].items[a].is_like=i.data.like_id,e.data[s].items[a].moments_like_count++}})},rmLike:function(t,a){var e=this,i=v.a.stringify({like_id:t});this.$http.post(SYS.URL.moments.like_remove,i).then(function(t){if(200===t.data.status){var i=e.tabId();e.data[i].items[a].is_like=0,e.data[i].items[a].moments_like_count--}})},doFollow:function(t,a){var e=this,i={};return i.tag_id=t,new c.a(function(t,a){e.$http.post(SYS.URL.moments.tag_follow_add,v.a.stringify(i)).then(function(a){var i=a.data;if(200===i.status){e.tabId();e.tagData.is_follow=i.data.follow_id}t(a)})})},rmFollow:function(t){var a=this;o.a.confirm("确定取消关注吗?").then(function(e){var i=v.a.stringify({follow_id:t});return new c.a(function(t,e){a.$http.post(SYS.URL.moments.tag_follow_remove,i).then(function(e){if(200===e.data.status){a.tabId();a.tagData.is_follow=0}t(e)})})})},dealData:function(t){var a=this.tabId();this.data[a].page=t.page+1,this.data[a].records=t.records,this.data[a].total=t.total,this.data[a].loaded=!0,t.total!=t.page&&0!=t.total||(this.data[a].more=!1)},fixItems:function(t){var a=this;return t.forEach(function(e,i){var s=a.maxWidth,n=e.image_heigth/e.image_width*a.maxWidth;n=Math.min(n,a.maxHeight),t[i].image_width=s,t[i].image_heigth=n,t[i].shown=!1,t[i].animate=!1}),t},masonry:function(){var t=this;return new c.a(function(a,e){document.querySelector("#waterfull"+t.activeIndex)&&p()(document.querySelector("#waterfull"+t.activeIndex),function(){new u.a("#waterfull"+t.activeIndex,{itemSelector:".moments-item",transitionDuration:0,resize:!1});var a=t.tabId();t.data[a].items.forEach(function(e,i){t.data[a].items[i].shown=!0,t.data[a].items[i].animate=!0})}),t.load=!0,a(t)})},goBack:function(){if(window.history.length<=1)return this.$router.push({path:"/"}),!1;this.$router.go(-1)},startMove:function(){this.maxDistance=.001},endMove:function(){this.maxDistance=0},upOut:function(){this.files=[],this.form={moments_title:"",moments_content:"",moments_tag_id:[],moments_tag_name:[],moments_area_id:"",moments_area_name:"",moments_product_id:[],moments_draft:1}},share:function(){if(isApp){var t=this.tagData.tag_name,a=this.tagData.tag_content,e=window.location.href,i=this.tagData.tag_album;if("android"===isApp&&android.share(t,a,e,i),"ios"===isApp){var n={title:t,describe:a,url:e,imgUrl:i},o=s()(n);window.webkit.messageHandlers.share.postMessage(o)}}},jumpVideoPlay:function(t){if(isApp){if("android"===isApp&&android.jumpVideoPlay(t,this.getKind()),"ios"===isApp){var a={moments_id:t,kind:this.getKind()},e=s()(a);window.webkit.messageHandlers.jumpVideoPlay.postMessage(e)}}else this.$router.push({path:"/detail/"+t})}},mounted:function(){var t=this;this.$refs.upload.initUploader(),this.maxWidth=document.documentElement.clientWidth/2,this.maxHeight=Math.ceil(1.33*this.maxWidth),this.active=this.$route.params.tab?this.$route.params.tab:"tab-container1",this.renderTab(this.active);var a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0,e=document.querySelector(".header").offsetHeight,i=document.querySelector(".banner").offsetHeight,s=document.querySelector(".nav-bar").offsetHeight;this.scrollHeight=a,this.navHeight=s;var n=i-e;window.addEventListener("scroll",function(){document.querySelector(".container").scrollTop>=n?(t.fixed=!0,t.showTitle=!0):(t.fixed=!1,t.showTitle=!1)},!0)},watch:{active:{handler:function(t){this.renderTab(t),this.maxDistance=0},deep:!0}},created:function(){this.tag_id=this.$route.params.tag_id,this.loadTagData()},beforeRouteEnter:function(t,a,e){e(function(t){for(var a=0;a<2;a++)t.$refs["wrapper"+(a+1)].scrollTop=t.$store.state.tag.position[a]})},beforeRouteLeave:function(t,a,e){var i=this.$refs["wrapper"+(this.activeIndex+1)].scrollTop;this.$store.commit("setPosition",{page:"tag",index:this.activeIndex,position:i}),e()}},y={render:function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("div",{staticClass:"page",attrs:{id:"tag"}},[i("div",{staticClass:"header ",class:t.showTitle?"":"header-transparent"},[i("div",{staticClass:"header-back",on:{click:t.goBack}}),t._v(" "),i("h3",{staticClass:"header-title",staticStyle:{height:"2rem"}},[t._v(t._s(t.showTitle?t.tagData.tag_name:""))]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isApp,expression:"isApp"}],staticClass:"header-share",on:{click:t.share}})]),t._v(" "),i("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],staticClass:"container",staticStyle:{overflow:"auto",top:"0"},style:{height:t.scrollHeight+"px"},attrs:{"infinite-scroll-disabled":"loading","infinite-scroll-distance":"10","infinite-scroll-immediate-check":"check"}},[i("div",{staticClass:"banner"},[i("div",{staticClass:"banner-album"},[i("img",{attrs:{src:t.tagData.tag_album?t.tagData.tag_album:"https://shop.xunyoutest.com/image.php/shop/data/upload/media/plantform/file/20190903/1567498245171301.jpg"}})]),t._v(" "),i("div",{staticClass:"banner-content"},[i("div",{staticClass:"banner-info"},[i("div",{staticClass:"banner-title"},[i("i",{staticClass:"icon icon-tag"}),t._v(t._s(t.tagData.tag_name)+"\n                ")]),t._v(" "),i("div",{staticClass:"banner-desc"},[t._v("\n                  "+t._s(t.tagData.tag_content)+"\n                ")])]),t._v(" "),i("div",{staticClass:"banner-tool"},[i("span",[t._v(t._s(t.tagData.tag_count)+"人参与")]),t._v(" "),i("span",[t._v(t._s(t.tagData.tag_view_count)+"人浏览")])]),t._v(" "),i("div",{staticClass:"banner-button"},[t.tagData.is_follow?i("span",{staticClass:"btn-followed",on:{click:function(a){return t.rmFollow(t.tagData.is_follow)}}},[t._v("已关注")]):i("span",{staticClass:"btn-follow",on:{click:function(a){return t.doFollow(t.tagData.tag_id)}}},[t._v("关注")])])])]),t._v(" "),i("div",{staticClass:"nav-container",style:{height:t.navHeight+"px"}},[i("div",{staticClass:"nav-bar",class:t.fixed?"nav-fixed":""},[i("div",{staticClass:"nav-inner",staticStyle:{width:"30%"}},[i("div",{staticClass:"nav-inner-item",class:"tab-container1"==t.active?"selected":"",on:{click:function(a){return t.renderTab("tab-container1")}}},[i("span",[t._v("最新")])]),t._v(" "),i("div",{staticClass:"nav-inner-item",class:"tab-container2"==t.active?"selected":"",on:{click:function(a){return t.renderTab("tab-container2")}}},[i("span",[t._v("最热")])])])])]),t._v(" "),i("div",{staticClass:"tab-container"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.loadVisible,expression:"loadVisible"}],staticClass:"mint-spinner-load"},[i("mt-spinner",{attrs:{type:"fading-circle"}})],1),t._v(" "),i("div",{staticClass:"tab-wrapper"},[i("my-tab-container",{staticClass:"page-tabbar-tab-container",attrs:{swipeable:t.swipeable},on:{"end-move":t.endMove,"start-move":t.startMove},model:{value:t.active,callback:function(a){t.active=a},expression:"active"}},[i("mt-tab-container-item",{attrs:{id:"tab-container1"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.data.tab1.loaded,expression:"data.tab1.loaded"}],ref:"wrapper1",staticClass:"moments-scroll",staticStyle:{overflow:"hidden"}},[i("mt-loadmore",{ref:"loadmore1",attrs:{"top-method":t.loadTop,maxDistance:t.maxDistance}},[i("div",{staticClass:"mint-spinner-top",attrs:{slot:"top"},slot:"top"},[i("mt-spinner",{attrs:{type:"fading-circle"}})],1),t._v(" "),t.data.tab1.items.length>0?i("div",{staticClass:"moments-list effect-1",attrs:{id:"waterfull0"}},[t._l(t.data.tab1.items,function(a,e){return i("div",{staticClass:"moments-item",class:a.shown?"shown animate":"",attrs:{index:a.index}},[i("div",{staticClass:"moments-wrap"},[i("div",{staticClass:"moments-media",style:{height:a.image_heigth+"px",maxHeight:t.maxHeight+"px"}},[1==a.moments_type?i("router-link",{attrs:{to:"/detail/"+a.moments_id}},[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:a.moments_image[0],expression:"item.moments_image[0]"}],staticStyle:{width:"100%",display:"block"}})]):4==a.moments_type?[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:a.moments_image[0],expression:"item.moments_image[0]"}],staticStyle:{width:"100%",display:"block"},on:{click:function(e){return t.jumpVideoPlay(a.moments_id)}}}),t._v(" "),i("i",{staticClass:"icon icon-video"})]:t._e()],2),t._v(" "),i("div",{staticClass:"moments-content"},[1==a.moments_type?i("router-link",{staticStyle:{display:"block"},attrs:{to:"/detail/"+a.moments_id}},[i("p",{domProps:{innerHTML:t._s(a.moments_title.toString())}})]):4==a.moments_type?i("p",{domProps:{innerHTML:t._s(a.moments_title.toString())},on:{click:function(e){return t.jumpVideoPlay(a.moments_id)}}}):t._e()],1),t._v(" "),i("div",{staticClass:"moments-info"},[i("router-link",{staticStyle:{display:"block"},attrs:{to:t.uid==a.user_id?"/home":"/user/"+a.user_id}},[i("div",{staticClass:"moments-uper"},[i("div",{staticClass:"uper-avatar"},[i("img",{staticStyle:{display:"block"},attrs:{alt:a.user_avatar,src:a.user_avatar}})]),t._v(" "),i("div",{staticClass:"uper-nickname"},[t._v("\n                                                "+t._s(a.user_nickname)+"\n                                            ")])])]),t._v(" "),i("div",{staticClass:"moments-collect"},[a.is_like?i("i",{staticClass:"icon icon-liked",on:{click:function(i){return t.rmLike(a.is_like,e)}}}):i("i",{staticClass:"icon icon-like",on:{click:function(i){return t.doLike(a.moments_id,e)}}}),t._v(" "),i("span",[t._v(t._s(a.moments_like_count))])])],1)])])})],2):i("div",{staticClass:"no-record"},[i("div",{staticClass:"no-record-content"},[i("div",{staticClass:"no-record-bg"},[i("img",{staticStyle:{width:"60px"},attrs:{src:e("62zQ")}})]),t._v(" "),i("p",[t._v("暂无相关的数据哦~")])])])])],1)]),t._v(" "),i("mt-tab-container-item",{attrs:{id:"tab-container2"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.data.tab2.loaded,expression:"data.tab2.loaded"}],ref:"wrapper2",staticClass:"moments-scroll",staticStyle:{overflow:"hidden"}},[i("mt-loadmore",{ref:"loadmore2",attrs:{"top-method":t.loadTop,maxDistance:t.maxDistance}},[i("div",{staticClass:"mint-spinner-top",attrs:{slot:"top"},slot:"top"},[i("mt-spinner",{attrs:{type:"fading-circle"}})],1),t._v(" "),t.data.tab2.items.length>0?i("div",{staticClass:"moments-list effect-1",attrs:{id:"waterfull1"}},[t._l(t.data.tab2.items,function(a,e){return i("div",{staticClass:"moments-item",class:{shown:a.shown,animate:a.animate},attrs:{index:a.index}},[i("div",{staticClass:"moments-wrap"},[i("div",{staticClass:"moments-media",style:{height:a.image_heigth+"px",maxHeight:t.maxHeight+"px"}},[1==a.moments_type?i("router-link",{attrs:{to:"/detail/"+a.moments_id}},[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:a.moments_image[0],expression:"item.moments_image[0]"}],staticStyle:{width:"100%",display:"block"}})]):4==a.moments_type?[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:a.moments_image[0],expression:"item.moments_image[0]"}],staticStyle:{width:"100%",display:"block"},on:{click:function(e){return t.jumpVideoPlay(a.moments_id)}}}),t._v(" "),i("i",{staticClass:"icon icon-video"})]:t._e()],2),t._v(" "),i("div",{staticClass:"moments-content"},[1==a.moments_type?i("router-link",{staticStyle:{display:"block"},attrs:{to:"/detail/"+a.moments_id}},[i("p",{domProps:{innerHTML:t._s(a.moments_title.toString())}})]):4==a.moments_type?i("p",{domProps:{innerHTML:t._s(a.moments_title.toString())},on:{click:function(e){return t.jumpVideoPlay(a.moments_id)}}}):t._e()],1),t._v(" "),i("div",{staticClass:"moments-info"},[i("router-link",{staticStyle:{display:"block"},attrs:{to:t.uid==a.user_id?"/home":"/user/"+a.user_id}},[i("div",{staticClass:"moments-uper"},[i("div",{staticClass:"uper-avatar"},[i("img",{staticStyle:{display:"block"},attrs:{alt:a.user_avatar,src:a.user_avatar}})]),t._v(" "),i("div",{staticClass:"uper-nickname"},[t._v("\n                                                  "+t._s(a.user_nickname)+"\n                                              ")])])]),t._v(" "),i("div",{staticClass:"moments-collect"},[a.is_like?i("i",{staticClass:"icon icon-liked",on:{click:function(i){return t.rmLike(a.is_like,e)}}}):i("i",{staticClass:"icon icon-like",on:{click:function(i){return t.doLike(a.moments_id,e)}}}),t._v(" "),i("span",[t._v(t._s(a.moments_like_count))])])],1)])])})],2):i("div",{staticClass:"no-record"},[i("div",{staticClass:"no-record-content"},[i("div",{staticClass:"no-record-bg"},[i("img",{staticStyle:{width:"60px"},attrs:{src:e("62zQ")}})]),t._v(" "),i("p",[t._v("暂无相关的数据哦~")])])])])],1)])],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.loadBotVisible,expression:"loadBotVisible"}],staticClass:"mint-spinner-bottom"},[i("mt-spinner",{attrs:{type:"fading-circle"}})],1)],1)])]),t._v(" "),i("upload",{ref:"upload",attrs:{files:t.files,container:t.container,browse_button:t.browse_button,form:t.form},on:{upout:t.upOut}},[i("div",{staticClass:"btn btn-upload",attrs:{slot:"file",id:"browse"},slot:"file"},[i("i",{staticClass:"icon icon-join"}),t._v(" "),i("span",{staticStyle:{"font-size":".5rem","font-weight":"600"}},[t._v("立即参与")])])]),t._v(" "),i("share",{ref:"share",attrs:{share:t.shareData}})],1)},staticRenderFns:[]};var k=e("VU/8")(w,y,!1,function(t){e("Bn7K")},"data-v-37059280",null);a.default=k.exports}});